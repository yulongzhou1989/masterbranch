<!DOCTYPE html>
{% load static %}
<html lang="en">
{% include "mysite/head.html" %}
<body id="page-top">
  {% include "mysite/nav.html" %}
  <section class="listHead listHead-heading bg-primary text-white text-uppercase mb-0 text-center ">
    <div class="ml-5">
      blogs
    </div>
  </section>
  <section class="page-section" id="list_body">
    <div class="container">
      <div class="row">
        <div class="col-md-12 col-lg-8">
          <div class="content_list">
            {% if articles %}
                <ul>
                {% for article in articles %}
                    <li><a href="/mysite/page/{{article.id}}">{{ article.title }}</a></li>
                {% endfor %}
                </ul>
            {% else %}
                <p>No contents are available.</p>
            {% endif %}
          </div>

          <!-- pagination -->
          {% if articles %}
          <div class="pagination-wrapper">
            {% if lek %}
              <input type="text" class="d-none" id="lek_id" name="id" value="{{ lek.id.S }}">
              <input type="text" class="d-none" id="lek_title" name="title" value="{{ lek.title.S }}">
            {% endif %}
            <svg class="page_btn btn--prev" height="60" viewBox="0 0 24 24" width="96" xmlns="http://www.w3.org/2000/svg">
              <path d="M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"/>
              <path d="M0-.5h24v24H0z" fill="none"/>
            </svg>
            <div class="pagination-container">
              <div class="little-dot  little-dot--first"></div>
              <div class="little-dot">
                <div class="big-dot-container">
                  <div class="big-dot"></div>
                </div>
              </div>
              <div class="little-dot  little-dot--last"></div>
            </div>
            <svg class="page_btn btn--next" height="60" viewBox="0 0 24 24" width="96" xmlns="http://www.w3.org/2000/svg">
              <path d="M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z"/>
              <path d="M0-.25h24v24H0z" fill="none"/>
            </svg>
          </div>
          {% endif %}
        </div>
      {% include "mysite/sidebar.html" %}
      </div>
    </div>
  </section>

  {% include "mysite/footer.html" %}
  <script src="{% static 'mysite/vendor/jquery/jquery.min.js' %}"></script>
  <script src="{% static 'mysite/js/site.js' %}"></script>
  <script src="{% static 'mysite/js/pagination.js' %}"></script>

  <script type="text/javascript">
    var pagination_stack = [];
    if (pagination_stack.length == 0) {
      if ($('#lek_id').val() == undefined) {
        $('.pagination-wrapper').addClass('d-none');
      } else {
        pagination_stack.push({'id': $('#lek_id').val(), 'title': $('#lek_title').val()});
        $('.btn--prev').addClass('d-none');
      }
    }

    $('.page_btn').click(function() {
      let lek = {'id': '', 'title': ''};
      var tmp_stack = [];
      if ($(this).hasClass('btn--prev')) {
        for (let i = 0; i < 3; i++) {
          if (pagination_stack.length >  0) {
            lek = pagination_stack.pop();
            if (i == 2) {
              tmp_stack.push(lek);
            }
          } else {
            lek = {'id': '', 'title': ''}
            break;
          }
        }
        next = false;
      } else {
        lek = pagination_stack.pop();
        tmp_stack.push(lek);
      }

      $.ajax (
        {
          type: 'GET',
          url:'/mysite/list_pagination',
          data: {
            lek_id: lek.id,
            lek_title: lek.title,
          },
          dataType: 'json',
          success: function(data) {
            generateContentList(data.articles, data.lek, tmp_stack);
          },
        }
      );
    });

    function generateContentList(articles, next_lek, tmp_stack) {

      while(tmp_stack.length > 0) {
        pagination_stack.push(tmp_stack.pop());
      }

      if (pagination_stack.length == 0) {
        $('.btn--prev').addClass('d-none');
      } else {
        $('.btn--prev').removeClass('d-none');
      }

      if(next_lek.id == '') {
        $('.btn--next').addClass('d-none');
      } else {
        $('.btn--next').removeClass('d-none');
      }

      pagination_stack.push(next_lek);

      var html="<div class='text-center text-primary lead'>No More Content.</div>";
      if (articles.length > 0) {
        html = "<ul>";
        $.each(articles, function(i, a){
          html+="<li><a href='/mysite/page/" + a.HASH + "'>" + a.RANGE + "</a></li>";
        });
        html += "</ul>";
      }
      $('.content_list').html(html);
    }
  </script>
</body>
</html>
